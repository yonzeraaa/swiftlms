(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3417],{12486:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(19946).A)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},22134:(e,t,s)=>{Promise.resolve().then(s.bind(s,71066))},38564:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(19946).A)("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]])},47863:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(19946).A)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]])},66474:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(19946).A)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},69037:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(19946).A)("award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]])},71066:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>B});var l=s(95155),a=s(12115),n=s(35695),r=s(69037),o=s(14186),i=s(85339),d=s(12486),c=s(5040),m=s(92657),u=s(35169),x=s(43453),h=s(17580),p=s(47863),g=s(66474),f=s(9803),j=s(19946);let v=(0,j.A)("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);var b=s(57434);let N=(0,j.A)("file-image",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]]);var w=s(38564),y=s(79720),_=s(767);function A(e){var t,s;let{tabs:n,defaultTab:r,onChange:o,variant:i="default",size:d="md",className:c="",fullWidth:m=!1}=e,[u,x]=(0,a.useState)(r||(null==(t=n[0])?void 0:t.id)),[h,p]=(0,a.useState)({}),g=(0,a.useRef)({});(0,a.useEffect)(()=>{let e=g.current[u];e&&"underline"===i&&p({left:e.offsetLeft,width:e.offsetWidth})},[u,i]);let f={sm:"text-xs px-3 py-1.5",md:"text-sm px-4 py-2",lg:"text-base px-5 py-2.5"},j=null==(s=n.find(e=>e.id===u))?void 0:s.content;return(0,l.jsxs)("div",{className:c,children:[(0,l.jsxs)("div",{className:(()=>{switch(i){case"pills":return"flex gap-2 p-1 bg-navy-800/50 rounded-lg";case"underline":return"relative flex border-b border-gold-500/20";default:return"flex border-b border-gold-500/20"}})(),children:[n.map(e=>(0,l.jsxs)("button",{ref:t=>{g.current[e.id]=t},onClick:()=>(e=>{let t=n.find(t=>t.id===e);t&&!t.disabled&&(x(e),null==o||o(e))})(e.id),disabled:e.disabled,className:((e,t)=>{let s="\n      relative flex items-center gap-2 font-medium\n      transition-all duration-200 focus:outline-none\n      ".concat(f[d],"\n      ").concat(t?"opacity-50 cursor-not-allowed":"cursor-pointer","\n      ").concat(m?"flex-1 justify-center":"","\n    ");switch(i){case"pills":return"\n          ".concat(s,"\n          rounded-lg\n          ").concat(e?"bg-gold-500 text-navy-900 shadow-lg shadow-gold-500/25":"text-gold-300 hover:text-gold-200 hover:bg-gold-500/10","\n        ");case"underline":return"\n          ".concat(s,"\n          border-b-2 border-transparent\n          ").concat(e?"text-gold-400":"text-gold-300 hover:text-gold-200","\n        ");default:return"\n          ".concat(s,"\n          rounded-t-lg\n          ").concat(e?"bg-navy-800 text-gold-400 border-t border-l border-r border-gold-500/30":"text-gold-300 hover:text-gold-200 hover:bg-navy-800/50","\n        ")}})(u===e.id,!!e.disabled),role:"tab","aria-selected":u===e.id,"aria-disabled":e.disabled,children:[e.icon&&(0,l.jsx)("span",{className:"flex-shrink-0",children:e.icon}),(0,l.jsx)("span",{children:e.label})]},e.id)),"underline"===i&&(0,l.jsx)("div",{className:"absolute bottom-0 h-0.5 bg-gold-400 transition-all duration-300",style:h})]}),(0,l.jsx)("div",{className:"mt-4 animate-in fade-in slide-in-from-bottom-2 duration-300",children:j})]})}var k=s(46414),S=s(13943),C=s(38274),E=s(60760),M=s(57918),q=s(82178),T=s(85690),P=s(9389),L=s(96675),D=s(9771),I=s(15273);function z(e){let{url:t,title:s,onComplete:n,autoPlay:r=!1}=e,o=(0,a.useRef)(null),i=(0,a.useRef)(null),[d,c]=(0,a.useState)(!1),[m,u]=(0,a.useState)(!1),[x,h]=(0,a.useState)(0),[p,g]=(0,a.useState)(0),[f,j]=(0,a.useState)(0),[v,b]=(0,a.useState)(!0),N=(0,a.useRef)(null);(0,a.useEffect)(()=>{let e=o.current;if(!e)return;let t=()=>{g(e.duration)},s=()=>{j(e.currentTime),h(e.currentTime/e.duration*100),e.currentTime===e.duration&&n&&n()},l=()=>c(!0),a=()=>c(!1);return e.addEventListener("loadedmetadata",t),e.addEventListener("timeupdate",s),e.addEventListener("play",l),e.addEventListener("pause",a),r&&e.play().catch(console.error),()=>{e.removeEventListener("loadedmetadata",t),e.removeEventListener("timeupdate",s),e.removeEventListener("play",l),e.removeEventListener("pause",a)}},[t,n,r]);let w=()=>{let e=o.current;e&&(d?e.pause():e.play())},y=e=>{let t=o.current;t&&(t.currentTime=Math.max(0,Math.min(t.currentTime+e,p)))},_=()=>{let e=i.current;e&&(document.fullscreenElement?document.exitFullscreen():e.requestFullscreen())},A=e=>{let t=Math.floor(e/60),s=Math.floor(e%60);return"".concat(t,":").concat(s.toString().padStart(2,"0"))},k=(null==t?void 0:t.includes("youtube.com"))||(null==t?void 0:t.includes("youtu.be")),S=null==t?void 0:t.includes("vimeo.com"),E=null==t?void 0:t.includes("drive.google.com");if(k||S||E){var z,O,R;let e="";if(k){let s=null==(z=t.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/))?void 0:z[1];e=s?"https://www.youtube.com/embed/".concat(s,"?autoplay=").concat(+!!r,"&rel=0&modestbranding=1"):""}else if(S){let s=null==(O=t.match(/vimeo\.com\/(\d+)/))?void 0:O[1];e=s?"https://player.vimeo.com/video/".concat(s,"?autoplay=").concat(+!!r):""}else if(E){let s=null==(R=t.match(/\/file\/d\/([^\/]+)/))?void 0:R[1];e=s?"https://drive.google.com/file/d/".concat(s,"/preview"):""}return e?(0,l.jsx)("div",{ref:i,className:"relative w-full bg-black rounded-lg overflow-hidden",children:(0,l.jsxs)("div",{className:"relative w-full aspect-video",children:[(0,l.jsx)("iframe",{src:e,className:"absolute inset-0 w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen",allowFullScreen:!0}),(0,l.jsx)("button",{onClick:_,className:"absolute bottom-4 right-4 p-2 rounded-full bg-black/50 hover:bg-black/70 transition-colors z-10",title:"Tela cheia",children:(0,l.jsx)(M.A,{className:"w-5 h-5 text-white"})})]})}):(0,l.jsx)("div",{className:"bg-navy-900/50 rounded-lg p-8 text-center",children:(0,l.jsx)("p",{className:"text-gold-300",children:"URL de v\xeddeo inv\xe1lida"})})}return(0,l.jsxs)("div",{ref:i,className:"relative w-full aspect-video bg-black rounded-lg overflow-hidden group",onMouseMove:()=>{b(!0),N.current&&clearTimeout(N.current),N.current=setTimeout(()=>{d&&b(!1)},3e3)},onMouseLeave:()=>d&&b(!1),children:[(0,l.jsx)("video",{ref:o,src:t,className:"w-full h-full object-contain",onClick:w}),(0,l.jsx)(C.P.div,{initial:!1,animate:{opacity:+!!v},transition:{duration:.3},className:"absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent pointer-events-none"}),(0,l.jsxs)(C.P.div,{initial:!1,animate:{opacity:+!!v},transition:{duration:.3},className:"absolute bottom-0 left-0 right-0 p-4 space-y-2",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("input",{type:"range",value:x,onChange:e=>{let t=o.current;t&&(t.currentTime=parseFloat(e.target.value)/100*p)},className:"flex-1 h-1 bg-gold-500/30 rounded-full appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:bg-gold-500 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer"}),(0,l.jsxs)("span",{className:"text-xs text-white",children:[A(f)," / ",A(p)]})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("button",{onClick:w,className:"p-2 rounded-full bg-gold-500/20 hover:bg-gold-500/30 transition-colors",children:d?(0,l.jsx)(q.A,{className:"w-5 h-5 text-white"}):(0,l.jsx)(T.A,{className:"w-5 h-5 text-white"})}),(0,l.jsx)("button",{onClick:()=>y(-10),className:"p-2 rounded-full bg-gold-500/20 hover:bg-gold-500/30 transition-colors",children:(0,l.jsx)(P.A,{className:"w-4 h-4 text-white"})}),(0,l.jsx)("button",{onClick:()=>y(10),className:"p-2 rounded-full bg-gold-500/20 hover:bg-gold-500/30 transition-colors",children:(0,l.jsx)(L.A,{className:"w-4 h-4 text-white"})}),(0,l.jsx)("button",{onClick:()=>{let e=o.current;e&&(e.muted=!m,u(!m))},className:"p-2 rounded-full bg-gold-500/20 hover:bg-gold-500/30 transition-colors",children:m?(0,l.jsx)(D.A,{className:"w-4 h-4 text-white"}):(0,l.jsx)(I.A,{className:"w-4 h-4 text-white"})})]}),(0,l.jsx)("button",{onClick:_,className:"p-2 rounded-full bg-gold-500/20 hover:bg-gold-500/30 transition-colors",children:(0,l.jsx)(M.A,{className:"w-4 h-4 text-white"})})]})]}),!d&&v&&(0,l.jsx)(C.P.button,{initial:{scale:0},animate:{scale:1},exit:{scale:0},onClick:w,className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-16 h-16 rounded-full bg-gold-500/30 backdrop-blur-sm flex items-center justify-center hover:bg-gold-500/40 transition-colors",children:(0,l.jsx)(T.A,{className:"w-8 h-8 text-white ml-1"})})]})}var O=s(33786),R=s(91788),V=s(54416),F=s(60567);function H(e){let{url:t,title:s,onComplete:n}=e,[r,o]=(0,a.useState)(!1),[i,d]=(0,a.useState)(!0),c=(0,a.useRef)(null),m=(0,a.useRef)(null),u=(e=>{if(e.includes("drive.google.com")||e.includes("docs.google.com")){let t="";if(e.includes("/document/d/"))return t=e.split("/document/d/")[1].split("/")[0],"https://docs.google.com/document/d/".concat(t,"/preview");if(e.includes("/presentation/d/"))return t=e.split("/presentation/d/")[1].split("/")[0],"https://docs.google.com/presentation/d/".concat(t,"/embed");if(e.includes("/spreadsheets/d/"))return t=e.split("/spreadsheets/d/")[1].split("/")[0],"https://docs.google.com/spreadsheets/d/".concat(t,"/preview");else if(e.includes("/file/d/"))return t=e.split("/file/d/")[1].split("/")[0],"https://drive.google.com/file/d/".concat(t,"/preview")}if(e.includes("onedrive.live.com")||e.includes("sharepoint.com")){let t=e.replace("/view.aspx","/embed.aspx");return t.includes("embed.aspx")?t:"".concat(e,"?embed=true")}return e.includes("dropbox.com")?e.replace("?dl=0","?raw=1"):(e.endsWith(".pdf"),e)})(t);(0,a.useEffect)(()=>{let e=()=>{o(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)},[]),(0,a.useEffect)(()=>{if(n){let e=setTimeout(()=>{n()},1e4);return()=>clearTimeout(e)}},[n]);let x=u.endsWith(".pdf");return(0,l.jsxs)("div",{ref:c,className:"relative w-full h-[600px] bg-navy-900/50 rounded-lg overflow-hidden flex flex-col",children:[(0,l.jsx)("div",{className:"relative bg-gradient-to-b from-black/70 to-transparent p-4 z-10 flex-shrink-0",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(b.A,{className:"w-5 h-5 text-gold-400"}),(0,l.jsx)("h3",{className:"text-white font-medium",children:s||"Documento"})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(C.P.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:()=>window.open(t,"_blank"),className:"p-2 rounded-full bg-gold-500/20 hover:bg-gold-500/30 transition-colors",title:"Abrir em nova aba",children:(0,l.jsx)(O.A,{className:"w-4 h-4 text-white"})}),!x&&(0,l.jsx)(C.P.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:()=>window.open(t,"_blank"),className:"p-2 rounded-full bg-gold-500/20 hover:bg-gold-500/30 transition-colors",title:"Baixar documento",children:(0,l.jsx)(R.A,{className:"w-4 h-4 text-white"})}),(0,l.jsx)(C.P.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:()=>{if(r)document.exitFullscreen&&document.exitFullscreen();else{var e;(null==(e=c.current)?void 0:e.requestFullscreen)&&c.current.requestFullscreen()}o(!r)},className:"p-2 rounded-full bg-gold-500/20 hover:bg-gold-500/30 transition-colors",title:r?"Sair da tela cheia":"Tela cheia",children:r?(0,l.jsx)(V.A,{className:"w-4 h-4 text-white"}):(0,l.jsx)(M.A,{className:"w-4 h-4 text-white"})})]})]})}),(0,l.jsx)(E.N,{children:i&&(0,l.jsx)(C.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 flex items-center justify-center bg-navy-900/50 z-20",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)(F.A,{size:"lg",className:"mx-auto mb-3"}),(0,l.jsx)("p",{className:"text-gold-300",children:"Carregando documento..."})]})})}),(0,l.jsx)("div",{className:"relative flex-1 w-full",children:x?(0,l.jsx)("embed",{src:u,type:"application/pdf",className:"w-full h-full",onLoad:()=>d(!1)}):(0,l.jsx)("iframe",{ref:m,src:u,className:"w-full h-full",frameBorder:"0",allowFullScreen:!0,onLoad:()=>d(!1),sandbox:"allow-scripts allow-same-origin allow-popups allow-forms",title:s||"Documento",style:{border:"none"}})}),!i&&(0,l.jsx)("div",{className:"absolute bottom-4 left-4 right-4 bg-navy-800/90 rounded-lg p-3 text-center z-20",children:(0,l.jsxs)("p",{className:"text-gold-300 text-sm",children:["Problemas para visualizar?",(0,l.jsx)("button",{onClick:()=>window.open(t,"_blank"),className:"ml-2 text-gold-400 hover:text-gold-200 underline",children:"Abrir documento original"})]})})]})}var U=s(35494);function B(){var e,t;let s=(0,n.useParams)(),j=(0,n.useRouter)(),M=(0,n.useSearchParams)(),q=s.id,T=M.get("lesson"),P=(0,k.U)(),[L,D]=(0,a.useState)(null),[I,O]=(0,a.useState)(!0),[R,V]=(0,a.useState)(null),[B,W]=(0,a.useState)(0),[J,Z]=(0,a.useState)(0),[G,K]=(0,a.useState)(!1),[Q,X]=(0,a.useState)("none"),[Y,$]=(0,a.useState)(!1),[ee,et]=(0,a.useState)(!1),[es,el]=(0,a.useState)(new Set),[ea,en]=(0,a.useState)(new Set),[er,eo]=(0,a.useState)([]);(0,a.useEffect)(()=>{q&&ei()},[q]),(0,a.useEffect)(()=>{if(L&&L.modules.length>0)if(R){for(let e of L.modules)for(let t of e.subjects)if(t.lessons.some(e=>e.id===R.id)){el(t=>new Set(t).add(e.id)),en(e=>new Set(e).add(t.id));return}}else el(new Set([L.modules[0].id])),L.modules[0].subjects.length>0&&en(new Set([L.modules[0].subjects[0].id]))},[R,L]);let ei=async()=>{try{let e,{data:{user:t}}=await P.auth.getUser();if(!t)return void j.push("/");let{data:s,error:l}=await P.from("courses").select("*").eq("id",q).single();if(l||!s){console.error("Error fetching course:",l),j.push("/student-dashboard/my-courses");return}let{data:a}=await P.from("profiles").select("role").eq("id",t.id).single(),n=(null==a?void 0:a.role)==="admin";K(n);let r=null;if(!n){let{data:e}=await P.from("enrollments").select("*").eq("course_id",q).eq("user_id",t.id).single();if(!e)return void j.push("/student-dashboard/courses");r=e}let{data:o}=await P.from("course_modules").select("\n          *,\n          module_subjects (\n            subject:subjects (\n              *,\n              subject_lessons (\n                lesson:lessons (*)\n              )\n            ),\n            order_index\n          )\n        ").eq("course_id",q).order("order_index"),i=[];if(r){let{data:e}=await P.from("lesson_progress").select("*").eq("enrollment_id",r.id);i=e||[]}let d=[],c=0,m=0,u=null;if(o)for(let e of o){let t=[],s=e.module_subjects||[];for(let e of(s.sort((e,t)=>(e.order_index||0)-(t.order_index||0)),s))if(e.subject){let s=e.subject,l=[];if(s.subject_lessons){for(let e of s.subject_lessons)if(e.lesson){let t=e.lesson,s=null==i?void 0:i.find(e=>e.lesson_id===t.id);(null==s?void 0:s.is_completed)?m++:u||(u=t),c++,l.push({...t,progress:s})}}l.sort((e,t)=>(e.order_index||0)-(t.order_index||0)),t.push({...s,lessons:l,order_index:e.order_index||0})}d.push({...e,subjects:t})}if(s.instructor_id){let{data:t}=await P.from("profiles").select("full_name, avatar_url").eq("id",s.instructor_id).single();t&&(e={name:t.full_name||"Instrutor",avatar:t.avatar_url||void 0})}if(D({...s,modules:d,enrollment:r||void 0,instructor:e}),W(c),Z(m),r){let{data:e}=await P.from("certificate_requests").select("status").eq("enrollment_id",r.id).single(),{data:s}=await P.from("certificates").select("approval_status").eq("enrollment_id",r.id).single();(null==s?void 0:s.approval_status)==="approved"?X("approved"):(null==e?void 0:e.status)==="pending"?X("pending"):(null==e?void 0:e.status)==="rejected"&&X("rejected");let l=c>0?m/c*100:0,{data:a}=await P.from("test_grades").select("best_score").eq("user_id",t.id).eq("course_id",q),n=a&&a.length>0?Math.max(...a.map(e=>e.best_score||0)):0;$(l>=100&&n>=70&&"none"===Q)}if(T){let e=d.flatMap(e=>e.subjects).flatMap(e=>e.lessons).find(e=>e.id===T);e&&V(e)}else u?V(u):d.length>0&&d[0].subjects.length>0&&d[0].subjects[0].lessons.length>0&&V(d[0].subjects[0].lessons[0]);let{data:x}=await P.from("course_reviews").select("rating, title, comment, created_at").eq("course_id",q).order("created_at",{ascending:!1});eo(x||[])}catch(e){console.error("Error fetching course data:",e),j.push("/student-dashboard/my-courses")}finally{O(!1)}},ed=e=>{let t=0,s=0;for(let l of e.subjects)t+=l.lessons.length,s+=l.lessons.filter(e=>{var t;return null==(t=e.progress)?void 0:t.is_completed}).length;return{completed:s,total:t}},ec=async()=>{if(null==L?void 0:L.enrollment)try{let{data:{user:e}}=await P.auth.getUser();if(!e)return;for(let t of L.modules.flatMap(e=>e.subjects).flatMap(e=>e.lessons))await P.from("lesson_progress").upsert({enrollment_id:L.enrollment.id,lesson_id:t.id,user_id:e.id,is_completed:!0,completed_at:new Date().toISOString()});let t={progress_percentage:100,status:"completed",completed_at:new Date().toISOString(),updated_at:new Date().toISOString()};await P.from("enrollments").update(t).eq("id",L.enrollment.id),alert("\uD83C\uDF89 Todas as aulas foram marcadas como conclu\xeddas!\n\n\uD83D\uDCDC Seu certificado ser\xe1 emitido pela administra\xe7\xe3o em breve."),await ei()}catch(e){console.error("Error marking all lessons complete:",e),alert("Erro ao marcar todas as aulas como conclu\xeddas")}},em=async()=>{if((null==L?void 0:L.enrollment)&&Y){et(!0);try{let e=await fetch("/api/certificates/check-eligibility",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({courseId:L.id,enrollmentId:L.enrollment.id})}),t=await e.json();e.ok&&t.success?(X("pending"),$(!1),alert("✅ Certificado solicitado com sucesso!\n\nAguarde a aprova\xe7\xe3o do administrador.")):alert("❌ Erro ao solicitar certificado:\n\n".concat(t.error||"Erro desconhecido"))}catch(e){console.error("Erro ao solicitar certificado:",e),alert("❌ Erro ao solicitar certificado. Tente novamente.")}finally{et(!1)}}},eu=async e=>{if(null==L?void 0:L.enrollment)try{let{data:{user:t}}=await P.auth.getUser();if(!t)return;let{error:s}=await P.from("lesson_progress").upsert({enrollment_id:L.enrollment.id,lesson_id:e,user_id:t.id,is_completed:!0,completed_at:new Date().toISOString()});if(!s){let t=J+1,s=B>0?Math.round(t/B*100):0,l={progress_percentage:s,updated_at:new Date().toISOString()};100===s?(l.status="completed",l.completed_at=new Date().toISOString(),await P.from("enrollments").update(l).eq("id",L.enrollment.id),alert("\uD83C\uDF89 Parab\xe9ns! Voc\xea concluiu este curso com sucesso!\n\n\uD83D\uDCDC Seu certificado ser\xe1 emitido pela administra\xe7\xe3o em breve.")):await P.from("enrollments").update(l).eq("id",L.enrollment.id);let a=null;for(let t=0;t<L.modules.length;t++){let s=L.modules[t];for(let l=0;l<s.subjects.length;l++){let n=s.subjects[l],r=n.lessons.findIndex(t=>t.id===e);if(-1!==r){if(r<n.lessons.length-1)a=n.lessons[r+1];else if(l<s.subjects.length-1){let e=s.subjects[l+1];e.lessons.length>0&&(a=e.lessons[0])}else if(t<L.modules.length-1){let e=L.modules[t+1];e.subjects.length>0&&e.subjects[0].lessons.length>0&&(a=e.subjects[0].lessons[0])}break}}if(a)break}a&&V(a),await ei()}}catch(e){console.error("Error marking lesson complete:",e)}},ex=B>0?J/B*100:0,eh=()=>G?null:(0,l.jsxs)("div",{className:"mt-4 space-y-3",children:["approved"===Q&&(0,l.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-green-900/20 border border-green-500/30 rounded-lg",children:[(0,l.jsx)(r.A,{className:"w-5 h-5 text-green-400"}),(0,l.jsx)("span",{className:"text-green-400",children:'Certificado aprovado! Acesse em \\"Meus Certificados\\"'})]}),"pending"===Q&&(0,l.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-yellow-900/20 border border-yellow-500/30 rounded-lg",children:[(0,l.jsx)(o.A,{className:"w-5 h-5 text-yellow-400"}),(0,l.jsx)("span",{className:"text-yellow-400",children:"Certificado solicitado - Aguardando aprova\xe7\xe3o"})]}),"rejected"===Q&&(0,l.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-red-900/20 border border-red-500/30 rounded-lg",children:[(0,l.jsx)(i.A,{className:"w-5 h-5 text-red-400"}),(0,l.jsx)("span",{className:"text-red-400",children:'Certificado rejeitado - Verifique em \\"Meus Certificados\\"'})]}),Y&&(0,l.jsx)(_.A,{variant:"primary",onClick:em,loading:ee,icon:(0,l.jsx)(d.A,{className:"w-4 h-4"}),className:"w-full",children:"Solicitar Certificado de Conclus\xe3o"}),!Y&&"none"===Q&&100===ex&&(0,l.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-navy-900/50 border border-gold-500/20 rounded-lg",children:[(0,l.jsx)(i.A,{className:"w-5 h-5 text-gold-400"}),(0,l.jsx)("span",{className:"text-gold-400 text-sm",children:"Voc\xea precisa atingir nota m\xednima de 70% no teste para solicitar o certificado"})]})]});return I?(0,l.jsx)("div",{className:"flex justify-center items-center min-h-[60vh]",children:(0,l.jsx)(F.A,{size:"xl"})}):L?(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsx)(U.A,{className:"mb-2"}),G&&(0,l.jsx)("div",{className:"bg-gradient-to-r from-blue-500/10 to-purple-500/10 border border-blue-500/30 rounded-lg p-4",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("div",{className:"w-10 h-10 bg-blue-500/20 rounded-full flex items-center justify-center",children:(0,l.jsx)(m.A,{className:"w-5 h-5 text-blue-400"})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm font-semibold text-blue-400",children:"Modo Preview Administrador"}),(0,l.jsx)("p",{className:"text-xs text-gold-400",children:"Voc\xea est\xe1 visualizando este curso como um administrador"})]})]}),(0,l.jsx)(_.A,{variant:"secondary",size:"sm",onClick:()=>j.push("/dashboard"),icon:(0,l.jsx)(u.A,{className:"w-4 h-4"}),children:"Voltar ao Painel Admin"})]})}),(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsx)(_.A,{variant:"ghost",onClick:()=>j.push(G?"/dashboard/lessons":"/student-dashboard/my-courses"),icon:(0,l.jsx)(u.A,{className:"w-4 h-4"}),children:"Voltar"}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold text-gold",children:L.title}),(0,l.jsx)("p",{className:"text-gold-300 mt-1",children:L.summary})]})]}),(0,l.jsx)(y.Ay,{variant:"gradient",className:"mb-6",children:(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,l.jsx)("div",{className:"flex items-center justify-center",children:(0,l.jsx)(S.A,{value:J,max:B,size:120,showValue:!0,label:"Progresso"})}),(0,l.jsxs)("div",{className:"md:col-span-3 space-y-4",children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-gold-300/70 text-sm",children:"Aulas Conclu\xeddas"}),(0,l.jsxs)("p",{className:"text-2xl font-bold text-gold",children:[J,"/",B]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-gold-300/70 text-sm",children:"Dura\xe7\xe3o Total"}),(0,l.jsxs)("p",{className:"text-2xl font-bold text-gold",children:[L.duration_hours,"h"]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-gold-300/70 text-sm",children:"N\xedvel"}),(0,l.jsx)("p",{className:"text-2xl font-bold text-gold",children:"beginner"===L.difficulty?"Iniciante":"intermediate"===L.difficulty?"Intermedi\xe1rio":"Avan\xe7ado"})]})]}),J<B&&(0,l.jsx)("div",{className:"mt-4",children:(0,l.jsx)(_.A,{onClick:ec,variant:"secondary",icon:(0,l.jsx)(x.A,{className:"w-4 h-4"}),children:"Marcar todas as aulas como conclu\xeddas"})}),(0,l.jsx)(eh,{}),L.instructor&&(0,l.jsxs)("div",{className:"flex items-center gap-3 pt-2 border-t border-gold-500/20",children:[(0,l.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-gold-500/30 to-gold-600/20 rounded-full flex items-center justify-center",children:L.instructor.avatar?(0,l.jsx)("img",{src:L.instructor.avatar,alt:L.instructor.name,className:"w-10 h-10 rounded-full object-cover"}):(0,l.jsx)(h.A,{className:"w-5 h-5 text-gold-400"})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-gold-300/70",children:"Instrutor"}),(0,l.jsx)("p",{className:"font-medium text-gold-200",children:L.instructor.name})]})]})]})]})}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,l.jsxs)("div",{className:"lg:col-span-1 space-y-4",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold text-gold mb-4",children:"Conte\xfado do Curso"}),L.modules.map((e,t)=>{let s=es.has(e.id),a=ed(e),n=a.completed===a.total&&a.total>0;return(0,l.jsx)(y.Ay,{variant:"glass",children:(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)(C.P.button,{onClick:()=>{var t;return t=e.id,void el(e=>{let s=new Set(e);return s.has(t)?s.delete(t):s.add(t),s})},className:"w-full text-left flex items-center justify-between gap-3 p-3 -m-3 rounded-lg transition-all hover:bg-navy-800/30",whileHover:{scale:1.01},whileTap:{scale:.99},children:[(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsx)("h3",{className:"font-semibold break-words ".concat(n?"text-green-400":"text-gold-200"),children:e.title}),(0,l.jsxs)("div",{className:"flex items-center gap-3 mt-1",children:[(0,l.jsxs)("span",{className:"text-xs text-gold-300/50",children:[a.completed,"/",a.total," aulas conclu\xeddas"]}),n&&(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[(0,l.jsx)(x.A,{className:"w-3 h-3 text-green-400"}),(0,l.jsx)("span",{className:"text-xs text-green-400",children:"Completo"})]})]})]}),(0,l.jsx)("div",{className:"flex-shrink-0",children:s?(0,l.jsx)(p.A,{className:"w-5 h-5 text-gold-400"}):(0,l.jsx)(g.A,{className:"w-5 h-5 text-gold-400"})})]}),e.description&&(0,l.jsx)("p",{className:"text-sm text-gold-300/70",children:e.description}),(0,l.jsx)(E.N,{children:s&&(0,l.jsx)(C.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:(0,l.jsx)("div",{className:"space-y-3 pt-2",children:e.subjects.map((e,t)=>{let s=ea.has(e.id),a=(e=>{let t=e.lessons.length;return{completed:e.lessons.filter(e=>{var t;return null==(t=e.progress)?void 0:t.is_completed}).length,total:t}})(e),n=a.completed===a.total&&a.total>0;return(0,l.jsxs)("div",{className:"border-l-2 border-gold-500/20 pl-4",children:[(0,l.jsxs)(C.P.button,{onClick:()=>{var t;return t=e.id,void en(e=>{let s=new Set(e);return s.has(t)?s.delete(t):s.add(t),s})},className:"w-full text-left flex items-center justify-between gap-3 p-2 -m-2 rounded-lg transition-all hover:bg-navy-800/20",whileHover:{scale:1.005},whileTap:{scale:.995},children:[(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsxs)("h4",{className:"text-sm font-medium break-words ".concat(n?"text-green-400":"text-gold-300"),children:["\uD83D\uDCDA ",e.code?"".concat(e.code," - ").concat(e.name):e.name]}),(0,l.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,l.jsxs)("span",{className:"text-xs text-gold-300/40",children:[a.completed,"/",a.total," aulas"]}),n&&(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[(0,l.jsx)(x.A,{className:"w-3 h-3 text-green-400"}),(0,l.jsx)("span",{className:"text-xs text-green-400",children:"Completo"})]})]})]}),(0,l.jsx)("div",{className:"flex-shrink-0",children:s?(0,l.jsx)(p.A,{className:"w-4 h-4 text-gold-400"}):(0,l.jsx)(g.A,{className:"w-4 h-4 text-gold-400"})})]}),e.description&&(0,l.jsx)("p",{className:"text-xs text-gold-300/60 mt-1 pl-2",children:e.description}),(0,l.jsx)(E.N,{children:s&&(0,l.jsx)(C.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2,ease:"easeInOut"},className:"overflow-hidden",children:(0,l.jsx)("div",{className:"space-y-1 pt-2 pl-2",children:e.lessons.map((e,t)=>{var s;let a=null==(s=e.progress)?void 0:s.is_completed,n=(null==R?void 0:R.id)===e.id;return(0,l.jsxs)(C.P.button,{onClick:()=>{V(e)},className:"\n                                                w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg transition-all group relative\n                                                ".concat(n?"bg-gold-500/20 text-gold shadow-lg shadow-gold-500/10":a?"text-green-400 hover:bg-green-500/10":"text-gold-300 hover:bg-navy-800/50 hover:text-gold-200","\n                                                cursor-pointer\n                                              "),whileHover:{scale:1.01},whileTap:{scale:.99},children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:a?(0,l.jsx)(x.A,{className:"w-4 h-4 text-green-400"}):(0,l.jsx)("div",{className:"w-4 h-4 rounded-full border-2 border-gold-500/50"})}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsx)("p",{className:"text-xs font-medium truncate whitespace-nowrap",children:e.title}),(0,l.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:["video"===e.content_type&&(0,l.jsx)(f.A,{className:"w-3 h-3 text-gold-400"}),"text"===e.content_type&&e.content_url&&(0,l.jsx)(v,{className:"w-3 h-3 text-gold-400"}),"text"===e.content_type&&!e.content_url&&(0,l.jsx)(b.A,{className:"w-3 h-3 text-gold-400"}),"document"===e.content_type&&(0,l.jsx)(N,{className:"w-3 h-3 text-gold-400"}),e.duration_minutes&&(0,l.jsxs)("span",{className:"text-xs text-gold-300/50 truncate",children:[e.duration_minutes," min"]})]})]})]},e.id)})})})})]},e.id)})})})})]})},e.id)})]}),(0,l.jsx)("div",{className:"lg:col-span-2",children:(0,l.jsx)(A,{variant:"underline",tabs:[{id:"conteudo",label:"Conte\xfado",content:R?(0,l.jsx)(y.Ay,{variant:"premium",className:"h-full",children:(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"flex items-start justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-2xl font-semibold text-gold mb-2",children:R.title}),R.description&&(0,l.jsx)("p",{className:"text-gold-300/70",children:R.description})]}),(null==(e=R.progress)?void 0:e.is_completed)&&(0,l.jsxs)("div",{className:"flex items-center gap-2 bg-green-500/20 px-3 py-1 rounded-full",children:[(0,l.jsx)(x.A,{className:"w-4 h-4 text-green-400"}),(0,l.jsx)("span",{className:"text-sm text-green-400",children:"Conclu\xedda"})]})]}),(0,l.jsx)("div",{className:"bg-navy-900/50 rounded-lg overflow-hidden",children:"video"===R.content_type?R.content_url?(0,l.jsx)(z,{url:R.content_url,title:R.title,onComplete:()=>{}}):(0,l.jsx)("div",{className:"flex items-center justify-center h-[400px]",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)(f.A,{className:"w-16 h-16 text-gold-500/30 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-gold-300",children:"V\xeddeo n\xe3o dispon\xedvel"}),(0,l.jsx)("p",{className:"text-gold-300/50 text-sm mt-2",children:"Nenhuma URL de v\xeddeo foi configurada para esta aula"})]})}):"text"===R.content_type?R.content_url?(0,l.jsx)(H,{url:R.content_url,title:R.title,onComplete:()=>{}}):(0,l.jsx)("div",{className:"w-full h-[400px] overflow-y-auto",children:(0,l.jsx)("div",{className:"prose prose-gold max-w-none",children:R.content?(0,l.jsx)("div",{className:"text-gold-200 leading-relaxed",dangerouslySetInnerHTML:{__html:R.content}}):(0,l.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)(b.A,{className:"w-16 h-16 text-gold-500/30 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-gold-300",children:"Conte\xfado n\xe3o dispon\xedvel"}),(0,l.jsx)("p",{className:"text-gold-300/50 text-sm mt-2",children:"Nenhum documento ou texto foi configurado para esta aula"})]})})})}):"document"===R.content_type?R.content_url?(0,l.jsx)(H,{url:R.content_url,title:R.title,onComplete:()=>{}}):(0,l.jsx)("div",{className:"flex items-center justify-center h-[400px]",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)(b.A,{className:"w-16 h-16 text-gold-500/30 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-gold-300",children:"Documento n\xe3o dispon\xedvel"}),(0,l.jsx)("p",{className:"text-gold-300/50 text-sm mt-2",children:"Nenhuma URL de documento foi configurada para esta aula"})]})}):(0,l.jsx)("div",{className:"flex items-center justify-center h-[400px]",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)(c.A,{className:"w-16 h-16 text-gold-500/30 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-gold-300",children:"Tipo de conte\xfado n\xe3o suportado"}),(0,l.jsxs)("p",{className:"text-gold-300/50 text-sm mt-2",children:["Tipo: ",R.content_type]})]})})}),(0,l.jsxs)("div",{className:"flex justify-between items-center pt-4 border-t border-gold-500/20",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gold-300/70",children:[(0,l.jsx)(o.A,{className:"w-4 h-4"}),(0,l.jsxs)("span",{children:[R.duration_minutes||0," minutos"]})]}),!(null==(t=R.progress)?void 0:t.is_completed)&&(0,l.jsx)(_.A,{variant:"primary",onClick:()=>eu(R.id),icon:(0,l.jsx)(x.A,{className:"w-4 h-4"}),children:"Marcar esta aula como conclu\xedda"})]})]})}):(0,l.jsx)(y.Ay,{className:"h-full flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)(c.A,{className:"w-16 h-16 text-gold-500/30 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-gold-300",children:"Selecione uma aula para come\xe7ar"})]})})},{id:"progresso",label:"Progresso",content:(0,l.jsx)(y.Ay,{children:(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-gold-300 text-sm mb-2",children:"Progresso do curso"}),(0,l.jsx)("div",{className:"w-full bg-navy-800 rounded-full h-2",children:(0,l.jsx)("div",{className:"h-2 rounded-full bg-gradient-to-r from-gold-500 to-gold-600 transition-all",style:{width:"".concat(Math.round(ex),"%")}})}),(0,l.jsxs)("div",{className:"flex items-center justify-between text-sm text-gold-400 mt-1",children:[(0,l.jsxs)("span",{children:[J,"/",B," aulas"]}),(0,l.jsxs)("span",{children:[Math.round(ex),"%"]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-gold-200 font-medium mb-2",children:"Por m\xf3dulo"}),(0,l.jsx)("div",{className:"space-y-3",children:L.modules.map(e=>{let t=ed(e),s=t.total>0?Math.round(t.completed/t.total*100):0;return(0,l.jsxs)("div",{className:"p-3 rounded-lg bg-navy-900/40 border border-gold-500/10",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,l.jsx)("p",{className:"text-sm text-gold-200 font-medium truncate",children:e.title}),(0,l.jsxs)("span",{className:"text-xs text-gold-400",children:[t.completed,"/",t.total," • ",s,"%"]})]}),(0,l.jsx)("div",{className:"w-full bg-navy-800 rounded-full h-1.5",children:(0,l.jsx)("div",{className:"h-1.5 rounded-full bg-gold-600",style:{width:"".concat(s,"%")}})})]},e.id)})})]})]})})},{id:"avaliacoes",label:"Avalia\xe7\xf5es",content:(0,l.jsx)(y.Ay,{children:(0,l.jsx)("div",{className:"space-y-4",children:0===er.length?(0,l.jsx)("p",{className:"text-gold-300",children:"Ainda n\xe3o h\xe1 avalia\xe7\xf5es para este curso."}):er.map((e,t)=>(0,l.jsxs)("div",{className:"p-3 rounded-lg bg-navy-900/40 border border-gold-500/10",children:[(0,l.jsx)("div",{className:"flex items-center gap-2",children:Array.from({length:5}).map((t,s)=>(0,l.jsx)(w.A,{className:"w-4 h-4 ".concat(s<(e.rating||0)?"text-gold-400":"text-gold-600")},s))}),e.title&&(0,l.jsx)("p",{className:"text-gold-200 font-medium mt-1",children:e.title}),e.comment&&(0,l.jsx)("p",{className:"text-gold-300/80 text-sm mt-1",children:e.comment}),e.created_at&&(0,l.jsx)("p",{className:"text-gold-500/60 text-xs mt-2",children:new Date(e.created_at).toLocaleDateString("pt-BR")})]},t))})})},{id:"certificados",label:"Certificados",content:(0,l.jsx)(y.Ay,{children:(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("h3",{className:"text-gold-200 font-medium",children:"Status de Certifica\xe7\xe3o"}),(0,l.jsx)(eh,{})]})})}]})})]})]}):(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[60vh]",children:[(0,l.jsx)(c.A,{className:"w-16 h-16 text-gold-500/30 mb-4"}),(0,l.jsx)("h2",{className:"text-xl font-semibold text-gold-200 mb-2",children:"Curso n\xe3o encontrado"}),(0,l.jsx)("p",{className:"text-gold-300/70 mb-4",children:"O curso que voc\xea est\xe1 procurando n\xe3o foi encontrado."}),(0,l.jsx)(_.A,{onClick:()=>j.push("/student-dashboard/my-courses"),children:"Voltar aos Meus Cursos"})]})}}},e=>{e.O(0,[3254,9051,7244,6174,1338,9760,5406,8441,5964,7358],()=>e(e.s=22134)),_N_E=e.O()}]);