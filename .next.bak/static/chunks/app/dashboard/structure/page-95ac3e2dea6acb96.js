(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3999],{24152:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>E});var a=t(95155),l=t(12115),i=t(5040),r=t(14395),d=t(21380),c=t(87949),n=t(57434),o=t(48623),u=t(94498),m=t(66474),x=t(13052),h=t(74575),p=t(62525),j=t(13717),g=t(85339),f=t(47924),b=t(54416),y=t(5196),N=t(79720),v=t(60567),w=t(35494),A=t(767),_=t(46414),C=t(38274),k=t(60760),S=t(46784);function E(){var e;let[s,t]=(0,l.useState)([]),[E,q]=(0,l.useState)(!0),[I,P]=(0,l.useState)(""),[M,T]=(0,l.useState)(null),[z,D]=(0,l.useState)(!1),[G,L]=(0,l.useState)("subject"),[O,V]=(0,l.useState)(null),[B,F]=(0,l.useState)([]),[H,R]=(0,l.useState)([]),[U,J]=(0,l.useState)(new Set),[K,Q]=(0,l.useState)(!1),[W,X]=(0,l.useState)("tree"),[Y,Z]=(0,l.useState)(null),[$,ee]=(0,l.useState)([]),es=(0,_.U)();(0,l.useEffect)(()=>{et()},[]);let et=async()=>{try{q(!0);let[e,s,a,l,i]=await Promise.all([es.from("courses").select("*").order("title"),es.from("course_modules").select("*").order("order_index"),es.from("subjects").select("id, code, name, description").order("name"),es.from("lessons").select("*").order("order_index"),es.from("tests").select("*").order("title")]);ee(e.data||[]),e.data&&e.data.length>0&&!Y&&Z(e.data[0].id);let[r,d]=await Promise.all([es.from("module_subjects").select("*").order("order_index"),es.from("subject_lessons").select("*")]),c=e.data||[],n=s.data||[],o=a.data||[],u=l.data||[],m=i.data||[],x=r.data||[],h=d.data||[],p=c.map(e=>{let s={id:e.id,type:"course",title:e.title,data:e,children:[]};return n.filter(s=>s.course_id===e.id).forEach(t=>{let a={id:t.id,type:"module",title:t.title,parentId:e.id,data:t,order:t.order_index,children:[]},l=x.filter(e=>e.module_id===t.id).map(e=>e.subject_id);o.filter(e=>l.includes(e.id)).forEach(e=>{let s={id:e.id,type:"subject",title:e.code?"".concat(e.code," - ").concat(e.name):e.name,parentId:t.id,data:e,children:[]},l=h.filter(s=>s.subject_id===e.id).map(e=>e.lesson_id);u.filter(e=>l.includes(e.id)).forEach(t=>{s.children.push({id:t.id,type:"lesson",title:t.title,parentId:e.id,data:t,order:t.order_index})}),m.filter(s=>s.subject_id===e.id).forEach(t=>{s.children.push({id:t.id,type:"test",title:t.title,parentId:e.id,data:t})}),s.children&&s.children.sort((e,s)=>"lesson"===e.type&&"lesson"===s.type?(e.order||0)-(s.order||0):0),a.children.push(s)}),s.children.push(a)}),s});t(p)}catch(e){console.error("Error fetching hierarchical data:",e)}finally{q(!1)}},ea=e=>{J(s=>{let t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t})},el=async(e,s)=>{V(e),L(s),R([]),D(!0);try{let t=[];if("module"===s&&"course"===e.type){let{data:s}=await es.from("course_modules").select("*").eq("course_id",e.id).order("order_index");t=s||[]}else if("subject"===s&&"module"===e.type){let{data:s}=await es.from("subjects").select("id, code, name, description").order("name"),{data:a}=await es.from("module_subjects").select("subject_id").eq("module_id",e.id),l=(null==a?void 0:a.map(e=>e.subject_id))||[];t=(null==s?void 0:s.filter(e=>!l.includes(e.id)))||[]}else if(("lesson"===s||"test"===s)&&"subject"===e.type)if("lesson"===s){let{data:s}=await es.from("lessons").select("*").order("title"),{data:a}=await es.from("subject_lessons").select("lesson_id").eq("subject_id",e.id),l=(null==a?void 0:a.map(e=>e.lesson_id))||[];t=(null==s?void 0:s.filter(e=>!l.includes(e.id)))||[]}else{let{data:s}=await es.from("tests").select("*").order("title");t=(null==s?void 0:s.filter(s=>s.subject_id!==e.id))||[]}F(t)}catch(e){console.error("Error loading available items:",e)}},ei=async()=>{if(O&&0!==H.length){Q(!0);try{if("subject"===G&&"module"===O.type){let e=H.map((e,s)=>({module_id:O.id,subject_id:e,order_index:s})),{error:s}=await es.from("module_subjects").insert(e);if(s)throw s}else if("lesson"===G&&"subject"===O.type){let e=H.map(e=>({subject_id:O.id,lesson_id:e})),{error:s}=await es.from("subject_lessons").insert(e);if(s)throw s}else if("test"===G&&"subject"===O.type){let{error:e}=await es.from("tests").update({subject_id:O.id}).in("id",H);if(e)throw e}D(!1),et()}catch(e){console.error("Error saving associations:",e),alert("Erro ao associar itens")}finally{Q(!1)}}},er=async e=>{if(confirm("module"===e.type?'Tem certeza que deseja excluir o m\xf3dulo "'.concat(e.title,'"? Isso remover\xe1 todas as associa\xe7\xf5es com disciplinas.'):'Tem certeza que deseja remover "'.concat(e.title,'" desta estrutura?')))try{if("module"===e.type){let{error:s}=await es.from("course_modules").delete().eq("id",e.id);if(s)throw s}else if("subject"===e.type&&e.parentId){let{error:s}=await es.from("module_subjects").delete().eq("module_id",e.parentId).eq("subject_id",e.id);if(s)throw s}else if("lesson"===e.type&&e.parentId){let{error:s}=await es.from("subject_lessons").delete().eq("subject_id",e.parentId).eq("lesson_id",e.id);if(s)throw s}else if("test"===e.type&&e.parentId){let{error:s}=await es.from("tests").update({subject_id:null}).eq("id",e.id);if(s)throw s}et()}catch(e){console.error("Error removing node:",e),alert("Erro ao remover item")}},ed=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.map(e=>{let t=U.has(e.id),l=e.children&&e.children.length>0,j=(null==M?void 0:M.id)===e.id;return(0,a.jsxs)("div",{className:"select-none",children:[(0,a.jsxs)(C.P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"\n              flex items-center gap-2 py-2 px-3 rounded-lg cursor-pointer\n              hover:bg-navy-800/50 transition-all group\n              ".concat(j?"bg-navy-800/70 ring-2 ring-gold-500/50":"","\n            "),style:{paddingLeft:"".concat(24*s+12,"px")},onClick:()=>{T(e),l&&ea(e.id)},children:[l&&(0,a.jsx)("button",{onClick:s=>{s.stopPropagation(),ea(e.id)},className:"p-0.5 hover:bg-navy-700 rounded",children:t?(0,a.jsx)(m.A,{className:"w-4 h-4 text-gold-400"}):(0,a.jsx)(x.A,{className:"w-4 h-4 text-gold-400"})}),!l&&(0,a.jsx)("div",{className:"w-5"}),((e,s)=>{switch(e){case"course":return(0,a.jsx)(i.A,{className:"w-4 h-4 text-gold-400"});case"module":return s?(0,a.jsx)(r.A,{className:"w-4 h-4 text-blue-400"}):(0,a.jsx)(d.A,{className:"w-4 h-4 text-blue-400"});case"subject":return(0,a.jsx)(c.A,{className:"w-4 h-4 text-green-400"});case"lesson":return(0,a.jsx)(n.A,{className:"w-4 h-4 text-purple-400"});case"test":return(0,a.jsx)(o.A,{className:"w-4 h-4 text-red-400"});default:return(0,a.jsx)(u.A,{className:"w-4 h-4 text-gold-300"})}})(e.type,t),(0,a.jsx)("span",{className:"flex-1 text-gold-200",children:e.title}),(0,a.jsx)("span",{className:"\n              px-2 py-0.5 rounded-full text-xs font-medium border\n              ".concat((e=>{switch(e){case"course":default:return"bg-gold-500/20 text-gold-400 border-gold-500/30";case"module":return"bg-blue-500/20 text-blue-400 border-blue-500/30";case"subject":return"bg-green-500/20 text-green-400 border-green-500/30";case"lesson":return"bg-purple-500/20 text-purple-400 border-purple-500/30";case"test":return"bg-red-500/20 text-red-400 border-red-500/30"}})(e.type),"\n            "),children:"course"===e.type?"Curso":"module"===e.type?"M\xf3dulo":"subject"===e.type?"Disciplina":"lesson"===e.type?"Aula":"Teste"}),(0,a.jsxs)("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:["course"===e.type&&(0,a.jsx)("button",{onClick:s=>{s.stopPropagation(),el(e,"module")},className:"p-1 hover:bg-navy-700 rounded",title:"Gerenciar M\xf3dulos",children:(0,a.jsx)(h.A,{className:"w-3 h-3 text-blue-400"})}),"module"===e.type&&(0,a.jsx)("button",{onClick:s=>{s.stopPropagation(),el(e,"subject")},className:"p-1 hover:bg-navy-700 rounded",title:"Associar Disciplinas",children:(0,a.jsx)(h.A,{className:"w-3 h-3 text-green-400"})}),"subject"===e.type&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:s=>{s.stopPropagation(),el(e,"lesson")},className:"p-1 hover:bg-navy-700 rounded",title:"Associar Aulas",children:(0,a.jsx)(h.A,{className:"w-3 h-3 text-purple-400"})}),(0,a.jsx)("button",{onClick:s=>{s.stopPropagation(),el(e,"test")},className:"p-1 hover:bg-navy-700 rounded",title:"Associar Testes",children:(0,a.jsx)(h.A,{className:"w-3 h-3 text-red-400"})})]}),("module"===e.type||"course"!==e.type&&e.parentId)&&(0,a.jsx)("button",{onClick:s=>{s.stopPropagation(),er(e)},className:"p-1 hover:bg-navy-700 rounded",title:"module"===e.type?"Excluir M\xf3dulo":"Remover da Estrutura",children:(0,a.jsx)(p.A,{className:"w-3 h-3 text-red-400"})})]})]}),(0,a.jsx)(k.N,{children:t&&l&&(0,a.jsx)(C.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},children:ed(e.children,s+1)})})]},e.id)})},ec=(e,s)=>e.reduce((e,t)=>{let a=t.title.toLowerCase().includes(s.toLowerCase()),l=t.children?ec(t.children,s):[];return(a||l.length>0)&&(e.push({...t,children:l}),s&&(a||l.length>0)&&U.add(t.id)),e},[]),en=I?ec(s,I):s;return E?(0,a.jsx)("div",{className:"flex justify-center items-center min-h-[60vh]",children:(0,a.jsx)(v.A,{size:"lg"})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(w.A,{className:"mb-2"}),(0,a.jsx)("div",{className:"flex justify-between items-start",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold text-gold flex items-center gap-2",children:[(0,a.jsx)(u.A,{className:"w-8 h-8"}),"Estrutura Hier\xe1rquica"]}),(0,a.jsx)("p",{className:"text-gold-300 mt-1",children:"Visualize a estrutura: Curso → M\xf3dulos → Disciplinas → Aulas/Testes"})]})}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(A.A,{variant:"tree"===W?"primary":"secondary",onClick:()=>X("tree"),icon:(0,a.jsx)(d.A,{className:"w-4 h-4"}),children:"Visualiza\xe7\xe3o em \xc1rvore"}),(0,a.jsx)(A.A,{variant:"manage"===W?"primary":"secondary",onClick:()=>X("manage"),icon:(0,a.jsx)(j.A,{className:"w-4 h-4"}),children:"Gerenciar Ordena\xe7\xe3o"})]}),(0,a.jsx)(N.Ay,{variant:"gradient",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)(g.A,{className:"w-5 h-5 text-gold-400 mt-0.5"}),(0,a.jsxs)("div",{className:"text-sm text-gold-300",children:[(0,a.jsx)("p",{className:"font-semibold text-gold-200 mb-1",children:"Como funciona:"}),(0,a.jsxs)("ul",{className:"space-y-1",children:[(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("span",{className:"text-gold-400",children:"Cursos"}),": Clique no \xedcone de link para gerenciar m\xf3dulos"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("span",{className:"text-blue-400",children:"M\xf3dulos"}),": Crie na p\xe1gina de M\xf3dulos e associe aos cursos"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("span",{className:"text-green-400",children:"Disciplinas"}),": Associe disciplinas existentes aos m\xf3dulos"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("span",{className:"text-purple-400",children:"Aulas"})," e ",(0,a.jsx)("span",{className:"text-red-400",children:"Testes"}),": Associe \xe0s disciplinas"]})]})]})]})}),(0,a.jsx)(N.Ay,{children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(f.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gold-400"}),(0,a.jsx)("input",{type:"text",placeholder:"Buscar na estrutura...",value:I,onChange:e=>P(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-navy-900/50 border border-navy-600 rounded-lg text-gold-100 placeholder-gold-300/50 focus:outline-none focus:ring-2 focus:ring-gold-500"})]})}),"tree"===W?(0,a.jsx)(N.Ay,{className:"min-h-[500px]",children:(0,a.jsx)("div",{className:"space-y-1",children:en.length>0?ed(en):(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(u.A,{className:"w-16 h-16 text-gold-500/30 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gold-300",children:I?"Nenhum item encontrado":"Nenhum curso cadastrado"})]})})}):(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,a.jsx)("div",{className:"lg:col-span-1",children:(0,a.jsxs)(N.Ay,{children:[(0,a.jsx)("h3",{className:"font-semibold text-gold mb-4",children:"Selecione o Curso"}),(0,a.jsx)("div",{className:"space-y-2",children:$.map(e=>(0,a.jsx)("button",{onClick:()=>Z(e.id),className:"w-full text-left p-3 rounded-lg transition-all ".concat(Y===e.id?"bg-gold-500/20 border border-gold-500/50":"bg-navy-800/30 hover:bg-navy-800/50 border border-navy-700"),children:(0,a.jsx)("span",{className:"text-sm font-medium text-gold-200",children:e.title})},e.id))})]})}),(0,a.jsx)("div",{className:"lg:col-span-3",children:Y&&$.find(e=>e.id===Y)?(0,a.jsx)(S.A,{courseId:Y,courseName:(null==(e=$.find(e=>e.id===Y))?void 0:e.title)||"",canManage:!0}):(0,a.jsxs)(N.Ay,{className:"text-center py-12",children:[(0,a.jsx)(u.A,{className:"w-12 h-12 text-gold-400/30 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gold-300/70",children:"Selecione um curso para gerenciar sua estrutura"})]})})]}),z&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[9999] p-4",children:(0,a.jsxs)(N.Ay,{className:"w-full max-w-2xl max-h-[80vh] overflow-hidden flex flex-col",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold text-gold flex items-center gap-2",children:[(0,a.jsx)(h.A,{className:"w-6 h-6"}),"module"===G?"Gerenciar M\xf3dulos":"Associar ".concat("subject"===G?"Disciplinas":"lesson"===G?"Aulas":"Testes")]}),(0,a.jsx)("button",{onClick:()=>D(!1),className:"text-gold-400 hover:text-gold-200",children:(0,a.jsx)(b.A,{className:"w-5 h-5"})})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto mb-4",children:0===B.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(g.A,{className:"w-12 h-12 text-gold-500/30 mx-auto mb-3"}),(0,a.jsx)("p",{className:"text-gold-300",children:"module"===G?"Nenhum m\xf3dulo criado para este curso":"Nenhum ".concat("subject"===G?"disciplina dispon\xedvel":"lesson"===G?"aula dispon\xedvel":"teste dispon\xedvel")}),(0,a.jsx)("p",{className:"text-gold-400 text-sm mt-2",children:"module"===G?"Crie m\xf3dulos na p\xe1gina de M\xf3dulos e eles aparecer\xe3o automaticamente aqui":"Crie novos itens na p\xe1gina correspondente antes de associ\xe1-los"})]}):(0,a.jsx)("div",{className:"space-y-2",children:B.map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-3 p-3 bg-navy-900/50 rounded-lg hover:bg-navy-900/70 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:H.includes(e.id),onChange:s=>{s.target.checked?R([...H,e.id]):R(H.filter(s=>s!==e.id))},className:"w-4 h-4 bg-navy-900/50 border-navy-600 rounded text-gold-500 focus:ring-gold-500"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-gold-200 font-medium",children:e.title||(e.code?"".concat(e.code," - ").concat(e.name):e.name)}),e.description&&(0,a.jsx)("p",{className:"text-gold-400 text-sm",children:e.description})]}),H.includes(e.id)&&(0,a.jsx)(y.A,{className:"w-5 h-5 text-green-400"})]},e.id))})}),(0,a.jsxs)("div",{className:"flex justify-between items-center pt-4 border-t border-gold-500/20",children:[(0,a.jsxs)("p",{className:"text-gold-300 text-sm",children:[H.length," ",1===H.length?"item selecionado":"itens selecionados"]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(A.A,{variant:"secondary",onClick:()=>D(!1),children:"Cancelar"}),(0,a.jsx)(A.A,{variant:"primary",onClick:ei,disabled:0===H.length||K,children:K?"Associando...":"Associar"})]})]})]})})]})}},87804:(e,s,t)=>{Promise.resolve().then(t.bind(t,24152))}},e=>{e.O(0,[3254,9051,7244,6227,4717,1338,9760,985,8441,5964,7358],()=>e(e.s=87804)),_N_E=e.O()}]);