"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4905],{5040:(e,t,s)=>{s.d(t,{A:()=>a});let a=(0,s(19946).A)("book-open",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]])},13730:(e,t,s)=>{s.d(t,{A:()=>p});var a=s(95155),l=s(12115),d=s(46414),o=s(94934),c=s(79720),i=s(767),n=s(57434),r=s(91788),x=s(33109),m=s(5040),h=s(16785),u=s(69037),j=s(47863),g=s(66474);function p(e){let{userId:t,userName:s,showHeader:p=!0,allowExport:v=!0,dateRange:N}=e,[b,y]=(0,l.useState)(!0),[f,w]=(0,l.useState)([]),[A,k]=(0,l.useState)(new Set),[S,M]=(0,l.useState)(0),[T,_]=(0,l.useState)(0),[D,E]=(0,l.useState)(0),z=(0,d.U)();(0,l.useEffect)(()=>{t&&R()},[t,N]);let R=async()=>{try{y(!0);let e=s;if(!e){let{data:s}=await z.from("profiles").select("full_name, email").eq("id",t).single();e=(null==s?void 0:s.full_name)||(null==s?void 0:s.email)||"Aluno"}let{data:a,error:l}=await z.from("tests").select("*, subjects(name), courses(title)").eq("is_active",!0);console.log("Tests Error:",l);let{data:d,error:o}=await z.from("test_attempts").select("*").eq("user_id",t);console.log("User ID:",t),console.log("All Tests:",null==a?void 0:a.length),console.log("Attempts:",null==d?void 0:d.length),console.log("Attempts Error:",o);let c=new Map;null==d||d.forEach(e=>{if(!e.test_id)return;let t=c.get(e.test_id);(!t||(e.score||0)>(t.score||0))&&c.set(e.test_id,e)});let i=new Map;console.log("Processing tests by subject...");let n=(null==a?void 0:a.filter(e=>!e.subject_id))||[];n.length>0&&console.warn("⚠️ ".concat(n.length," testes sem subject_id:"),n),null==a||a.forEach(e=>{console.log("Test:",e.id,e.title,"Subject:",e.subject_id);let t=e.subject_id||"no-subject",s=c.get(e.id),a=s&&Number(s.score)||0,l=!!s;if(!i.has(t)){var d,o;let s=e.subject_id?(null==(d=e.subjects)?void 0:d.name)||"Disciplina n\xe3o encontrada":"Sem Disciplina Definida";i.set(t,{subjectId:t,subjectName:s,courseName:(null==(o=e.courses)?void 0:o.title)||"Sem curso",totalTests:0,testsCompleted:0,testsMissed:0,average:0,highestScore:0,lowestScore:100,tests:[]})}let n=i.get(t);n.totalTests++,l?(n.testsCompleted++,a>n.highestScore&&(n.highestScore=a),a<n.lowestScore&&(n.lowestScore=a)):(n.testsMissed++,n.lowestScore=0),n.tests.push({id:e.id,title:e.title,score:a,completed:l,date:(null==s?void 0:s.submitted_at)?new Date(s.submitted_at).toLocaleDateString("pt-BR"):void 0})});let r=Array.from(i.values());r.forEach(e=>{let t=e.tests.reduce((e,t)=>e+t.score,0);e.average=e.totalTests>0?t/e.totalTests:0});let x=r.reduce((e,t)=>e+t.totalTests,0),m=r.reduce((e,t)=>e+t.testsCompleted,0),h=r.reduce((e,t)=>e+t.average,0),u=r.length>0?h/r.length:0;_(x),E(m),M(u),w(r)}catch(e){console.error("Erro ao buscar notas:",e)}finally{y(!1)}},C=async()=>{let e=new o.xc,t=f.map(e=>({Disciplina:e.subjectName,Curso:e.courseName,"Total de Testes":e.totalTests,"Testes Realizados":e.testsCompleted,"Testes N\xe3o Realizados":e.testsMissed,Média:Number(e.average.toFixed(1)),"Maior Nota":e.highestScore,"Menor Nota":e.lowestScore})),a=[];f.forEach(e=>{e.tests.forEach(t=>{a.push({Disciplina:e.subjectName,Teste:t.title,Nota:t.score,Status:t.completed?"Realizado":"N\xe3o Realizado",Data:t.date||"-"})})}),e.addDataSheet("Resumo por Disciplina",{title:"Hist\xf3rico de Notas - ".concat(s||"Aluno"),headers:Object.keys(t[0]||{}),data:t.map(e=>Object.values(e)),metadata:{date:new Date().toLocaleDateString("pt-BR"),user:s||"Aluno"},formatting:{conditionalFormatting:[{condition:e=>"number"==typeof e&&e<70,font:{bold:!0,color:"#FF0000"}}],columns:{5:{condition:e=>"number"==typeof e&&e<70,font:{bold:!0,color:"#FF0000"}}}}}),e.addDataSheet("Detalhamento",{title:"Detalhamento de Testes",headers:Object.keys(a[0]||{}),data:a.map(e=>Object.values(e)),formatting:{conditionalFormatting:[{condition:e=>"number"==typeof e&&e<70,font:{bold:!0,color:"#FF0000"}},{condition:e=>"N\xe3o Realizado"===e,font:{color:"#808080"}}]}}),e.addSummarySheet("Estat\xedsticas",{title:"Estat\xedsticas Gerais",sections:[{sectionTitle:"Resumo",metrics:[{label:"M\xe9dia Geral",value:S.toFixed(1)},{label:"Total de Testes",value:T},{label:"Testes Realizados",value:D},{label:"Testes N\xe3o Realizados",value:T-D},{label:"Taxa de Participa\xe7\xe3o",value:"".concat((D/T*100).toFixed(1),"%")}]}]});let l="notas_".concat((null==s?void 0:s.replace(/\s+/g,"_").toLowerCase())||"aluno","_").concat(new Date().toISOString().split("T")[0],".xlsx");e.download(l)};return b?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"h-32 bg-navy-800/50 rounded-xl animate-pulse"}),(0,a.jsx)("div",{className:"h-24 bg-navy-800/50 rounded-xl animate-pulse"}),(0,a.jsx)("div",{className:"h-24 bg-navy-800/50 rounded-xl animate-pulse"})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[p&&(0,a.jsx)("div",{className:"flex justify-between items-start",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-gold flex items-center gap-2",children:[(0,a.jsx)(n.A,{className:"w-6 h-6"}),"Hist\xf3rico de Notas"]}),s&&(0,a.jsxs)("p",{className:"text-gold-300 mt-1",children:["Aluno: ",s]})]})}),v&&!p&&(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(i.A,{variant:"primary",size:"sm",icon:(0,a.jsx)(r.A,{className:"w-4 h-4"}),onClick:C,children:"Exportar Excel"})}),p&&v&&(0,a.jsx)("div",{className:"flex justify-end -mt-12",children:(0,a.jsx)(i.A,{variant:"primary",size:"sm",icon:(0,a.jsx)(r.A,{className:"w-4 h-4"}),onClick:C,children:"Exportar Excel"})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsx)(c.Ay,{className:"bg-gradient-to-br from-navy-800/50 to-navy-900/50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-gold-400 text-sm",children:"M\xe9dia Geral"}),(0,a.jsx)("p",{className:"text-3xl font-bold ".concat(S>=70?"text-gold":"text-red-500"),children:S.toFixed(1)})]}),(0,a.jsx)(x.A,{className:"w-8 h-8 ".concat(S>=70?"text-gold-500":"text-red-500")})]})}),(0,a.jsx)(c.Ay,{className:"bg-gradient-to-br from-navy-800/50 to-navy-900/50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-gold-400 text-sm",children:"Total de Testes"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-gold",children:T})]}),(0,a.jsx)(m.A,{className:"w-8 h-8 text-gold-500"})]})}),(0,a.jsx)(c.Ay,{className:"bg-gradient-to-br from-navy-800/50 to-navy-900/50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-gold-400 text-sm",children:"Realizados"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-green-500",children:D})]}),(0,a.jsx)(h.A,{className:"w-8 h-8 text-green-500"})]})}),(0,a.jsx)(c.Ay,{className:"bg-gradient-to-br from-navy-800/50 to-navy-900/50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-gold-400 text-sm",children:"Taxa de Participa\xe7\xe3o"}),(0,a.jsxs)("p",{className:"text-3xl font-bold text-gold",children:[T>0?Math.round(D/T*100):0,"%"]})]}),(0,a.jsx)(u.A,{className:"w-8 h-8 text-gold-500"})]})})]}),(0,a.jsx)("div",{className:"space-y-4",children:f.map(e=>(0,a.jsxs)(c.Ay,{className:"overflow-hidden",children:[(0,a.jsx)("div",{className:"p-6 cursor-pointer hover:bg-navy-800/30 transition-colors",onClick:()=>(e=>{let t=new Set(A);t.has(e)?t.delete(e):t.add(e),k(t)})(e.subjectId),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-gold",children:e.subjectName}),(0,a.jsx)("p",{className:"text-sm text-gold-400 mt-1",children:e.courseName}),(0,a.jsxs)("div",{className:"flex items-center gap-6 mt-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gold-500 text-sm",children:"M\xe9dia: "}),(0,a.jsx)("span",{className:"font-bold text-lg ".concat(e.average>=70?"text-gold":"text-red-500"),children:e.average.toFixed(1)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gold-500 text-sm",children:"Progresso: "}),(0,a.jsxs)("span",{className:"text-gold-200",children:[e.testsCompleted,"/",e.totalTests," testes"]})]})]}),(0,a.jsx)("div",{className:"mt-3 bg-navy-900/50 rounded-full h-2 overflow-hidden",children:(0,a.jsx)("div",{className:"h-full bg-gradient-to-r from-gold-500 to-gold-600 transition-all duration-500",style:{width:"".concat(e.testsCompleted/e.totalTests*100,"%")}})})]}),(0,a.jsx)("div",{className:"ml-4",children:A.has(e.subjectId)?(0,a.jsx)(j.A,{className:"w-5 h-5 text-gold-400"}):(0,a.jsx)(g.A,{className:"w-5 h-5 text-gold-400"})})]})}),A.has(e.subjectId)&&(0,a.jsxs)("div",{className:"border-t border-gold-500/20 p-6 bg-navy-900/30",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-gold-500 text-sm",children:"Maior Nota"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-green-500",children:e.highestScore})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-gold-500 text-sm",children:"Menor Nota"}),(0,a.jsx)("p",{className:"text-2xl font-bold ".concat(e.lowestScore>=70?"text-gold":"text-red-500"),children:e.lowestScore})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-gold-500 text-sm",children:"N\xe3o Realizados"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-orange-500",children:e.testsMissed})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("p",{className:"text-gold-400 font-medium mb-2",children:"Detalhamento dos Testes:"}),e.tests.map(e=>(0,a.jsxs)("div",{className:"flex justify-between items-center p-3 rounded-lg ".concat(e.completed?"bg-navy-800/50":"bg-navy-900/50"),children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium ".concat(e.completed?"text-gold-200":"text-gold-600"),children:e.title}),e.date&&(0,a.jsxs)("p",{className:"text-xs text-gold-500 mt-1",children:["Data: ",e.date]})]}),(0,a.jsx)("div",{className:"ml-4",children:e.completed?(0,a.jsx)("span",{className:"font-bold text-lg ".concat(e.score>=70?"text-gold":"text-red-500"),children:e.score}):(0,a.jsx)("span",{className:"text-gold-600 text-sm",children:"N\xe3o Realizado"})})]},e.id))]})]})]},e.subjectId))}),0===f.length&&(0,a.jsx)(c.Ay,{className:"text-center py-12",children:(0,a.jsx)("p",{className:"text-gold-400",children:"Nenhum teste encontrado para este aluno."})})]})}},16785:(e,t,s)=>{s.d(t,{A:()=>a});let a=(0,s(19946).A)("target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]])},33109:(e,t,s)=>{s.d(t,{A:()=>a});let a=(0,s(19946).A)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]])},47863:(e,t,s)=>{s.d(t,{A:()=>a});let a=(0,s(19946).A)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]])},57434:(e,t,s)=>{s.d(t,{A:()=>a});let a=(0,s(19946).A)("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},66474:(e,t,s)=>{s.d(t,{A:()=>a});let a=(0,s(19946).A)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},69037:(e,t,s)=>{s.d(t,{A:()=>a});let a=(0,s(19946).A)("award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]])},69074:(e,t,s)=>{s.d(t,{A:()=>a});let a=(0,s(19946).A)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},91788:(e,t,s)=>{s.d(t,{A:()=>a});let a=(0,s(19946).A)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]])}}]);